# åˆ†äº«åŠŸèƒ½è®¾è®¡

## 1. åŠŸèƒ½æ¦‚è¿°

### 1.1 éœ€æ±‚èƒŒæ™¯
ç”¨æˆ·å¸Œæœ›å°†å¯¹è¯å†…å®¹åˆ†äº«ç»™ä»–äººæŸ¥çœ‹ï¼Œä½†ä¸éœ€è¦å¯¹æ–¹ç™»å½•æˆ–æ³¨å†Œï¼Œç±»ä¼¼"èŠå¤©è®°å½•å¿«ç…§"çš„åŠŸèƒ½ã€‚

### 1.2 æ ¸å¿ƒåœºæ™¯
1. **æŠ€æœ¯é—®é¢˜æ’æŸ¥**ï¼šåˆ†äº«æŠ€æœ¯è®¨è®ºè®°å½•ç»™å›¢é˜Ÿæˆå‘˜
2. **ä¼šè®®çºªè¦åˆ†äº«**ï¼šåˆ†äº«ä¼šè®®è®¨è®ºå†…å®¹ç»™æœªå‚ä¼šäººå‘˜
3. **ç»å…¸å¯¹è¯å­˜æ¡£**ï¼šä¿å­˜æœ‰ä»·å€¼çš„å¯¹è¯è®°å½•ä¾›åç»­æŸ¥é˜…

### 1.3 çº¦æŸæ¡ä»¶
- æŸ¥çœ‹è€…æ— éœ€ç™»å½•
- é“¾æ¥æœ‰æ—¶æ•ˆæ€§ï¼ˆå¯é…ç½®è¿‡æœŸæ—¶é—´ï¼‰
- åªè¯»è®¿é—®ï¼Œæ— æ³•å›å¤
- ä¿æŠ¤éšç§ï¼Œå¯é€‰æ‹©æ¶ˆæ¯èŒƒå›´

---

## 2. ç”¨æˆ·äº¤äº’è®¾è®¡

### 2.1 åˆ†äº«æµç¨‹

```
ç”¨æˆ·åœ¨èŠå¤©ç•Œé¢
    â”‚
    â”œâ”€â†’ ç‚¹å‡»"åˆ†äº«"æŒ‰é’®ï¼ˆé¡¶éƒ¨æˆ–èœå•ï¼‰
    â”‚       â”‚
    â”‚       â””â”€â†’ å¼¹å‡ºåˆ†äº«é…ç½®å¯¹è¯æ¡†
    â”‚               â”‚
    â”‚               â”œâ”€â†’ é€‰æ‹©åˆ†äº«èŒƒå›´
    â”‚               â”‚   â”œâ”€ å…¨éƒ¨æ¶ˆæ¯
    â”‚               â”‚   â”œâ”€ æœ€è¿‘ N æ¡æ¶ˆæ¯
    â”‚               â”‚   â””â”€ è‡ªå®šä¹‰æ—¶é—´èŒƒå›´
    â”‚               â”‚
    â”‚               â”œâ”€â†’ è®¾ç½®è¿‡æœŸæ—¶é—´
    â”‚               â”‚   â”œâ”€ 1å¤©
    â”‚               â”‚   â”œâ”€ 7å¤©
    â”‚               â”‚   â”œâ”€ 30å¤©
    â”‚               â”‚   â””â”€ æ°¸ä¹…æœ‰æ•ˆ
    â”‚               â”‚
    â”‚               â”œâ”€â†’ é¢„è§ˆåˆ†äº«å†…å®¹
    â”‚               â”‚
    â”‚               â””â”€â†’ ç¡®è®¤åˆ†äº«
    â”‚                       â”‚
    â”‚                       â””â”€â†’ ç”Ÿæˆåˆ†äº«é“¾æ¥
    â”‚                               â”‚
    â”‚                               â””â”€â†’ æ˜¾ç¤ºåˆ†äº«é“¾æ¥ï¼ˆå¯å¤åˆ¶ï¼‰
```

### 2.2 æŸ¥çœ‹æµç¨‹

```
ä»–äººç‚¹å‡»åˆ†äº«é“¾æ¥
    â”‚
    â”œâ”€â†’ æ‰“å¼€åˆ†äº«é¡µé¢
    â”‚       â”‚
    â”‚       â”œâ”€â†’ æ˜¾ç¤ºåˆ†äº«æ ‡é¢˜
    â”‚       â”œâ”€â†’ æ˜¾ç¤ºå‚ä¸è€…ä¿¡æ¯ï¼ˆè„±æ•ï¼‰
    â”‚       â”œâ”€â†’ æ˜¾ç¤ºæ¶ˆæ¯åˆ—è¡¨ï¼ˆåªè¯»ï¼‰
    â”‚       â””â”€â†’ æ˜¾ç¤ºè¿‡æœŸæç¤º
```

### 2.3 ç®¡ç†æµç¨‹

```
ç”¨æˆ·æŸ¥çœ‹"æˆ‘çš„åˆ†äº«"
    â”‚
    â”œâ”€â†’ æ˜¾ç¤ºæ‰€æœ‰åˆ†äº«è®°å½•
    â”‚       â”‚
    â”‚       â”œâ”€â†’ åˆ†äº«æ—¶é—´
    â”‚       â”œâ”€â†’ å¯¹è¯ä¿¡æ¯
    â”‚       â”œâ”€â†’ è¿‡æœŸçŠ¶æ€
    â”‚       â”œâ”€â†’ å¤åˆ¶é“¾æ¥
    â”‚       â””â”€â†’ å–æ¶ˆåˆ†äº«
```

---

## 3. æ•°æ®æ¨¡å‹è®¾è®¡

### 3.1 ç°æœ‰æ¨¡å‹ï¼ˆå·²å®ç°ï¼‰

```go
// SharedConversation åˆ†äº«çš„ä¼šè¯æ¨¡å‹
type SharedConversation struct {
    ID             int64  `json:"id"`
    ConversationID int64  `json:"conversation_id"`  // åŸä¼šè¯ID
    ShareToken     string `json:"share_token"`       // åˆ†äº«ä»¤ç‰Œï¼ˆURLä¸­ï¼‰
    CreatedBy      int64  `json:"created_by"`        // åˆ›å»ºè€…
    ExpireAt       int64  `json:"expire_at"`         // è¿‡æœŸæ—¶é—´ï¼ˆ0=æ°¸ä¹…ï¼‰
    CreatedAt      int64  `json:"created_at"`        // åˆ›å»ºæ—¶é—´
}
```

### 3.2 æ‰©å±•æ¨¡å‹ï¼ˆéœ€è¦æ–°å¢ï¼‰

```go
// SharedConversationDetail åˆ†äº«è¯¦æƒ…ï¼ˆç”¨äºå±•ç¤ºï¼‰
type SharedConversationDetail struct {
    ID               int64           `json:"id"`
    ShareToken       string          `json:"share_token"`
    ConversationID   int64           `json:"conversation_id"`
    Participants     []ParticipantInfo `json:"participants"`  // è„±æ•çš„å‚ä¸è€…ä¿¡æ¯
    MessageCount     int             `json:"message_count"`
    FirstMessageID   int64           `json:"first_message_id"`  // åˆ†äº«èµ·å§‹æ¶ˆæ¯ID
    LastMessageID    int64           `json:"last_message_id"`   // åˆ†äº«ç»“æŸæ¶ˆæ¯ID
    ExpireAt         int64           `json:"expire_at"`
    CreatedAt        int64           `json:"created_at"`
    IsExpired        bool            `json:"is_expired"`
}

// ParticipantInfo å‚ä¸è€…ä¿¡æ¯ï¼ˆè„±æ•ï¼‰
type ParticipantInfo struct {
    ID       int64  `json:"id"`
    Nickname string `json:"nickname"`
    Avatar   string `json:"avatar,omitempty"`
}

// ShareRequest åˆ›å»ºåˆ†äº«è¯·æ±‚
type ShareRequest struct {
    ConversationID int64  `json:"conversation_id" binding:"required"`
    ExpireDays     int    `json:"expire_days"`      // è¿‡æœŸå¤©æ•°ï¼Œ0=æ°¸ä¹…ï¼Œé»˜è®¤7
    MessageRange   string `json:"message_range"`    // "all", "recent", "custom"
    RecentCount    int    `json:"recent_count"`     // æœ€è¿‘Næ¡ï¼Œå½“range=recentæ—¶
    SinceMessageID int64  `json:"since_message_id"` // ä»æŸæ¡æ¶ˆæ¯å¼€å§‹
}

// ShareResponse åˆ›å»ºåˆ†äº«å“åº”
type ShareResponse struct {
    ID          int64  `json:"id"`
    ShareToken  string `json:"share_token"`
    ShareURL    string `json:"share_url"`      // å®Œæ•´çš„åˆ†äº«URL
    ExpireAt    int64  `json:"expire_at"`
    MessageCount int   `json:"message_count"`
}
```

---

## 4. API æ¥å£è®¾è®¡

### 4.1 åˆ›å»ºåˆ†äº«

#### POST /api/conversations/:id/share
åˆ›å»ºä¼šè¯åˆ†äº«

**è¯·æ±‚å¤´:**
```
Authorization: Bearer <token>
Content-Type: application/json
```

**è·¯å¾„å‚æ•°:**
| å‚æ•° | ç±»å‹ | è¯´æ˜ |
|------|------|------|
| id | int64 | ä¼šè¯ID |

**è¯·æ±‚ä½“:**
```json
{
  "expire_days": 7,           // è¿‡æœŸå¤©æ•°ï¼Œ0=æ°¸ä¹…ï¼Œé»˜è®¤7
  "message_range": "recent",  // all/recent/customï¼Œé»˜è®¤recent
  "recent_count": 50          // æœ€è¿‘Næ¡ï¼Œé»˜è®¤50
}
```

**å“åº” (200):**
```json
{
  "id": 1,
  "share_token": "abc123xyz",
  "share_url": "https://lanser.fun/zmessage/shared/abc123xyz",
  "expire_at": 1708204800,
  "message_count": 50
}
```

**é”™è¯¯å“åº”:**
- `400 Bad Request`: å‚æ•°é”™è¯¯
- `403 Forbidden`: æ— æƒåˆ†äº«è¯¥ä¼šè¯
- `404 Not Found`: ä¼šè¯ä¸å­˜åœ¨

---

### 4.2 æŸ¥çœ‹åˆ†äº«å†…å®¹

#### GET /api/shared/:token
è·å–åˆ†äº«çš„ä¼šè¯å†…å®¹

**æŸ¥è¯¢å‚æ•°:**
| å‚æ•° | ç±»å‹ | å¿…å¡« | é»˜è®¤å€¼ | è¯´æ˜ |
|------|------|------|--------|------|
| before_id | int64 | å¦ | - | åˆ†é¡µï¼šè·å–æ­¤IDä¹‹å‰çš„æ¶ˆæ¯ |
| limit | int | å¦ | 50 | è¿”å›æ•°é‡ï¼Œæœ€å¤§100 |

**å“åº” (200):**
```json
{
  "share": {
    "id": 1,
    "share_token": "abc123xyz",
    "participants": [
      {
        "id": 1,
        "nickname": "Alice",
        "avatar": "api/media/42"
      },
      {
        "id": 2,
        "nickname": "Bob",
        "avatar": null
      }
    ],
    "message_count": 50,
    "expire_at": 1708204800,
    "created_at": 1707600000,
    "is_expired": false
  },
  "messages": [
    {
      "id": 100,
      "sender_id": 1,
      "sender_nickname": "Alice",
      "type": "text",
      "content": "Hello!",
      "created_at": 1707599000
    },
    {
      "id": 101,
      "sender_id": 2,
      "sender_nickname": "Bob",
      "type": "text",
      "content": "Hi there!",
      "created_at": 1707599100
    }
  ],
  "has_more": true
}
```

**é”™è¯¯å“åº”:**
- `404 Not Found`: åˆ†äº«ä¸å­˜åœ¨æˆ–å·²è¿‡æœŸ

---

### 4.3 è·å–æˆ‘çš„åˆ†äº«åˆ—è¡¨

#### GET /api/shares
è·å–å½“å‰ç”¨æˆ·åˆ›å»ºçš„æ‰€æœ‰åˆ†äº«

**è¯·æ±‚å¤´:**
```
Authorization: Bearer <token>
```

**æŸ¥è¯¢å‚æ•°:**
| å‚æ•° | ç±»å‹ | å¿…å¡« | é»˜è®¤å€¼ | è¯´æ˜ |
|------|------|------|--------|------|
| page | int | å¦ | 1 | é¡µç  |
| limit | int | å¦ | 20 | æ¯é¡µæ•°é‡ |

**å“åº” (200):**
```json
{
  "shares": [
    {
      "id": 1,
      "share_token": "abc123xyz",
      "share_url": "https://lanser.fun/zmessage/shared/abc123xyz",
      "conversation": {
        "id": 1,
        "participant": {
          "id": 2,
          "nickname": "Bob",
          "avatar": null
        }
      },
      "message_count": 50,
      "expire_at": 1708204800,
      "created_at": 1707600000,
      "is_expired": false,
      "view_count": 10
    }
  ],
  "total": 5
}
```

---

### 4.4 å–æ¶ˆåˆ†äº«

#### DELETE /api/shares/:id
å–æ¶ˆåˆ†äº«ï¼ˆåˆ é™¤åˆ†äº«è®°å½•ï¼‰

**è¯·æ±‚å¤´:**
```
Authorization: Bearer <token>
```

**å“åº” (200):**
```json
{
  "success": true
}
```

**é”™è¯¯å“åº”:**
- `403 Forbidden`: æ— æƒåˆ é™¤è¯¥åˆ†äº«
- `404 Not Found`: åˆ†äº«ä¸å­˜åœ¨

---

## 5. å‰ç«¯ç•Œé¢è®¾è®¡

### 5.1 åˆ†äº«æŒ‰é’®ä½ç½®

åœ¨èŠå¤©ç•Œé¢çš„é¡¶éƒ¨å¯¼èˆªæ æ·»åŠ åˆ†äº«æŒ‰é’®ï¼š

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  â† Bob          â‹® æ›´å¤š              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                   â†“ ç‚¹å‡»
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              æ›´å¤šèœå•                â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  ğŸ“‹ åˆ†äº«å¯¹è¯                         â”‚
â”‚  ğŸ” æœç´¢æ¶ˆæ¯                         â”‚
â”‚  ğŸ—‘ï¸ æ¸…ç©ºèŠå¤©                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 5.2 åˆ†äº«é…ç½®å¯¹è¯æ¡†

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚         åˆ†äº«å¯¹è¯                     â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                     â”‚
â”‚  åˆ†äº«èŒƒå›´                            â”‚
â”‚  â—‹ å…¨éƒ¨æ¶ˆæ¯ (123æ¡)                 â”‚
â”‚  â— æœ€è¿‘ 50 æ¡                       â”‚
â”‚  â—‹ è‡ªå®šä¹‰æ—¶é—´                       â”‚
â”‚                                     â”‚
â”‚  è¿‡æœŸæ—¶é—´                            â”‚
â”‚  â—‹ 1å¤©                              â”‚
â”‚  â—‹ 7å¤©                              â”‚
â”‚  â— 30å¤©                             â”‚
â”‚  â—‹ æ°¸ä¹…æœ‰æ•ˆ                         â”‚
â”‚                                     â”‚
â”‚  [é¢„è§ˆ]              [å–æ¶ˆ] [åˆ†äº«]  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 5.3 åˆ†äº«æˆåŠŸæç¤º

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚         åˆ†äº«æˆåŠŸ                     â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                     â”‚
â”‚  åˆ†äº«é“¾æ¥å·²ç”Ÿæˆï¼Œ30å¤©åè¿‡æœŸ           â”‚
â”‚                                     â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚ https://lanser.fun/...       â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                     â”‚
â”‚          [å¤åˆ¶é“¾æ¥] [å®Œæˆ]          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 5.4 åˆ†äº«é¡µé¢ï¼ˆæŸ¥çœ‹è€…è§†è§’ï¼‰

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚         ğŸ“± å¯¹è¯åˆ†äº«                 â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  Alice ä¸ Bob çš„å¯¹è¯                â”‚
â”‚  50æ¡æ¶ˆæ¯ Â· åˆ†äº«äº 2024-01-15       â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                     â”‚
â”‚  Alice  10:30                       â”‚
â”‚  ä½ å¥½ï¼                             â”‚
â”‚                                     â”‚
â”‚  Bob    10:31                       â”‚
â”‚  å—¨ï¼Œæœ‰ä»€ä¹ˆäº‹å—ï¼Ÿ                    â”‚
â”‚                                     â”‚
â”‚  Alice  10:32                       â”‚
â”‚  æƒ³é—®ä½ ä¸€ä¸ªé—®é¢˜...                  â”‚
â”‚                                     â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚      æ­¤åˆ†äº«å°†åœ¨ 28 å¤©åè¿‡æœŸ          â”‚
â”‚                                     â”‚
â”‚      ç”± zMessage æä¾›æ”¯æŒ            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 5.5 æˆ‘çš„åˆ†äº«é¡µé¢

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚         æˆ‘çš„åˆ†äº«                     â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                     â”‚
â”‚  ğŸ“± ä¸ Bob çš„å¯¹è¯                   â”‚
â”‚     50æ¡æ¶ˆæ¯ Â· 28å¤©åè¿‡æœŸ            â”‚
â”‚     [å¤åˆ¶é“¾æ¥] [å–æ¶ˆåˆ†äº«]            â”‚
â”‚                                     â”‚
â”‚  ğŸ“± ä¸ Charlie çš„å¯¹è¯               â”‚
â”‚     å…¨éƒ¨æ¶ˆæ¯ Â· å·²è¿‡æœŸ                â”‚
â”‚     [åˆ é™¤è®°å½•]                      â”‚
â”‚                                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## 6. å®‰å…¨ä¸éšç§è®¾è®¡

### 6.1 éšç§ä¿æŠ¤

1. **å‚ä¸è€…ä¿¡æ¯è„±æ•**
   - åªæ˜¾ç¤ºæ˜µç§°å’Œå¤´åƒ
   - éšè—ç”¨æˆ·åå’ŒçœŸå®èº«ä»½ä¿¡æ¯
   - éšè—åœ¨çº¿çŠ¶æ€

2. **æ¶ˆæ¯å†…å®¹è¿‡æ»¤**
   - ä¸æ˜¾ç¤ºæ¶ˆæ¯çŠ¶æ€ï¼ˆsent/delivered/readï¼‰
   - ä¸æ˜¾ç¤ºæ¶ˆæ¯ç¼–è¾‘/åˆ é™¤å†å²
   - åª’ä½“æ–‡ä»¶éœ€éªŒè¯æƒé™

3. **è®¿é—®æ§åˆ¶**
   - é“¾æ¥ä¸å¯æšä¸¾ï¼ˆä½¿ç”¨éšæœºtokenï¼‰
   - è¿‡æœŸåç«‹å³å¤±æ•ˆ
   - å¯éšæ—¶å–æ¶ˆåˆ†äº«

### 6.2 å®‰å…¨æªæ–½

1. **Token ç”Ÿæˆ**
   ```go
   // ä½¿ç”¨ crypto/rand ç”Ÿæˆ 16 å­—èŠ‚éšæœºtoken
   // Base32 ç¼–ç åçº¦ä¸º 26 å­—ç¬¦
   func generateShareToken() string {
       b := make([]byte, 16)
       crypto.Read(b)
       return base32.StdEncoding.EncodeToString(b)
   }
   ```

2. **é˜²çˆ¬è™«**
   - åˆ†äº«é¡µé¢æ·»åŠ  `robots.txt` é™åˆ¶
   - æ·»åŠ  `noindex` meta æ ‡ç­¾
   - å¯é€‰ï¼šæ·»åŠ ç®€å•çš„éªŒè¯ç 

3. **é¢‘ç‡é™åˆ¶**
   - é™åˆ¶å•ä¸ªç”¨æˆ·åˆ›å»ºåˆ†äº«æ•°é‡ï¼ˆå¦‚æ¯å¤©æœ€å¤š10ä¸ªï¼‰
   - é™åˆ¶è®¿é—®é¢‘ç‡ï¼ˆé˜²æ¶æ„æŠ“å–ï¼‰

---

## 7. åç«¯å®ç°

### 7.1 æ¨¡å—ç»“æ„

```
server/
â”œâ”€â”€ modules/
â”‚   â””â”€â”€ share/              # æ–°å¢åˆ†äº«æ¨¡å—
â”‚       â”œâ”€â”€ service.go      # åˆ†äº«æœåŠ¡
â”‚       â””â”€â”€ errors.go       # é”™è¯¯å®šä¹‰
â”œâ”€â”€ api/
â”‚   â””â”€â”€ share.go            # åˆ†äº«API handler
â””â”€â”€ dal/
    â””â”€â”€ shared.go           # å·²å­˜åœ¨
```

### 7.2 æœåŠ¡æ¥å£

```go
package share

type Service interface {
    // CreateShare åˆ›å»ºåˆ†äº«
    CreateShare(req *CreateShareRequest, creatorID int64) (*SharedConversationDetail, error)

    // GetShare è·å–åˆ†äº«è¯¦æƒ…
    GetShare(token string) (*SharedConversationDetail, error)

    // GetShareMessages è·å–åˆ†äº«çš„æ¶ˆæ¯åˆ—è¡¨
    GetShareMessages(token string, beforeID int64, limit int) ([]*Message, bool, error)

    // ListShares è·å–ç”¨æˆ·çš„åˆ†äº«åˆ—è¡¨
    ListShares(userID int64, page, limit int) ([]*SharedConversationDetail, int, error)

    // DeleteShare åˆ é™¤åˆ†äº«
    DeleteShare(shareID, userID int64) error

    // CleanupExpired æ¸…ç†è¿‡æœŸåˆ†äº«
    CleanupExpired() error
}
```

### 7.3 å®šæ—¶ä»»åŠ¡

```go
// æ¯å°æ—¶æ¸…ç†ä¸€æ¬¡è¿‡æœŸåˆ†äº«
func startCleanupTask(svc share.Service) {
    ticker := time.NewTicker(1 * time.Hour)
    go func() {
        for range ticker.C {
            svc.CleanupExpired()
        }
    }()
}
```

---

## 8. å‰ç«¯å®ç°

### 8.1 æ–°å¢æ¨¡å—

```
client/assets/js/modules/
â””â”€â”€ share.js              # åˆ†äº«æ¨¡å—

client/assets/js/pages/
â””â”€â”€ shared.html           # åˆ†äº«é¡µé¢ï¼ˆå¯é€‰ï¼Œæˆ–åŠ¨æ€æ¸²æŸ“ï¼‰
```

### 8.2 Share æ¨¡å—æ¥å£

```javascript
export class ShareModule {
    // åˆ›å»ºåˆ†äº«
    async createShare(conversationID, options)

    // è·å–åˆ†äº«å†…å®¹
    async getSharedContent(token, beforeID, limit)

    // è·å–æˆ‘çš„åˆ†äº«åˆ—è¡¨
    async getMyShares(page, limit)

    // åˆ é™¤åˆ†äº«
    async deleteShare(shareID)

    // å¤åˆ¶åˆ†äº«é“¾æ¥
    copyShareURL(shareURL)
}
```

### 8.3 è·¯ç”±å¤„ç†

åˆ†äº«é¡µé¢éœ€è¦æ”¯æŒç›´æ¥è®¿é—®ï¼Œå› æ­¤ï¼š

1. **æ–¹æ¡ˆAï¼šç‹¬ç«‹é¡µé¢**
   - åˆ›å»º `client/shared.html`
   - Nginx é…ç½®ï¼š`location /zmessage/shared { ... }`

2. **æ–¹æ¡ˆBï¼šåŠ¨æ€æ¸²æŸ“**ï¼ˆæ¨èï¼‰
   - å¤ç”¨ç°æœ‰ `index.html`
   - æ ¹æ® URL å‚æ•°åŠ¨æ€æ˜¾ç¤ºåˆ†äº«å†…å®¹
   - URL: `/zmessage/?shared=abc123xyz`

---

## 9. å®ç°ä¼˜å…ˆçº§

### Phase 1: æ ¸å¿ƒåŠŸèƒ½ï¼ˆMVPï¼‰
- [x] æ•°æ®åº“è¡¨å’Œ DALï¼ˆå·²å®Œæˆï¼‰
- [ ] åˆ›å»ºåˆ†äº« API
- [ ] æŸ¥çœ‹åˆ†äº« API
- [ ] åŸºç¡€å‰ç«¯ UIï¼ˆåˆ†äº«æŒ‰é’®ã€å¯¹è¯æ¡†ï¼‰
- [ ] åˆ†äº«é¡µé¢æ¸²æŸ“

### Phase 2: å¢å¼ºåŠŸèƒ½
- [ ] æˆ‘çš„åˆ†äº«åˆ—è¡¨
- [ ] æ¶ˆæ¯èŒƒå›´é€‰æ‹©
- [ ] åˆ†äº«é¢„è§ˆ
- [ ] è¿‡æœŸæ—¶é—´é…ç½®

### Phase 3: ä¼˜åŒ–åŠŸèƒ½
- [ ] è®¿é—®ç»Ÿè®¡
- [ ] åˆ†äº«å¯†ç ä¿æŠ¤
- [ ] æ‰¹é‡æ“ä½œ
- [ ] äºŒç»´ç åˆ†äº«

---

## 10. æµ‹è¯•è¦ç‚¹

### åŠŸèƒ½æµ‹è¯•
- [ ] åˆ›å»ºåˆ†äº«ï¼ˆå…¨éƒ¨/æœ€è¿‘/è‡ªå®šä¹‰ï¼‰
- [ ] æŸ¥çœ‹åˆ†äº«å†…å®¹
- [ ] è¿‡æœŸåˆ†äº«è®¿é—®
- [ ] å–æ¶ˆåˆ†äº«
- [ ] åª’ä½“æ–‡ä»¶åŠ è½½

### è¾¹ç•Œæµ‹è¯•
- [ ] ç©ºå¯¹è¯åˆ†äº«
- [ ] è¶…é•¿å¯¹è¯åˆ†äº«
- [ ] è¿‡æœŸæ—¶é—´è¾¹ç•Œ
- [ ] æ— æ•ˆ token

### å®‰å…¨æµ‹è¯•
- [ ] Token ä¸å¯æšä¸¾
- [ ] è¶Šæƒè®¿é—®å…¶ä»–ç”¨æˆ·çš„åˆ†äº«
- [ ] è¿‡æœŸåˆ†äº«ç«‹å³å¤±æ•ˆ
